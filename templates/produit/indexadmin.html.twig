{% extends 'utilisateur/base.html.twig' %}

{% block title %}{% endblock %}

{% block container %}
    <div>
    <td>
                <a href="{{ path('app_produit_search') }}" class="btn">Search</a>
</td>

        
        <h4>Table of Products</h4>

        <table class="table">
            <thead>
                <tr>
                    <th>idProd</th>
                    <th>Name Product</th>
                    <th>Description</th>
					<th>quantity</th>
				    <th>image</th>
					<th>Price</th>
					 <th>Category</th>




                    <!-- Autres colonnes spÃ©cifiques aux Produits -->
                    <th>actions</th>
                </tr>
            </thead>
           <tbody>
    {% for produit in produits %}
        <tr>
            <td>{{ produit.idProd }}</td>
            <td>{{ produit.nomProd }}</td>
            <td>{{ produit.descriptionProd }}</td>
			<td>{{ produit.quantite }}</td>

            <td>
                {% if produit.image %}
                    <img src="{{ asset('uploads/images/' ~ produit.image) }}" alt="Product Image" style="max-width: 100px;">
                {% else %}
                    NO IMAGE AVAILABLE FOR THIS PRODUCT
                {% endif %}
            </td>
            <td>{{ produit.prixProd}}</td>
            <td>{{ produit.categorie.nomCategorie}}</td>
            <td>
                
                <a href="{{ path('app_produit_edit', {'idProd': produit.idProd}) }}">edit</a>
            </td>
           
        </tr>
    {% else %}
        <tr>
            <td colspan="7">no records found</td>
        </tr>
    {% endfor %}
</tbody>
</table>

<a href="{{ path('app_produit_new') }}">Create new</a>

                            <div class="pagination text-center mt-4">
                               {{ knp_pagination_render(produits) }}
                               </div>
{% endblock %}
{% block js %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $("#search").keyup(function (e) {
            var value = $(this).val();

            $.ajax({
                url: "{{ path('search_produit_by_name') }}",  // Mettez le chemin de votre route de recherche ici
                type: 'GET',
                data: {
                    'searchValue': value
                },
                success: function (retour) {
                    if (retour) {
                        $('#produitBody').hide();
                        $('#searchBody').empty();
                        $.each(JSON.parse(retour), function (i, obj) {
                            $('#searchBody').append('<tr><td>' + obj.nomProd + '</td><td>' + obj.prixProd + ' </td><td><a href="app_produit_show/' + obj.idProd + '">show produit</a> <br><a href="app_produit_edit/' + obj.idProd + '">edit produit</a></td></tr>');
                        });
                        $('#searchTable').show();
                    } else {
                        $('#produitBody').show();
                        $('#searchTable').hide();
                    }
                },
            });
            return false;
        });
    });
</script>


{% endblock %}